<!doctype html>
<html lang="en-us">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>golang test 使用教程 | garfcat</title>
    <meta property="og:title" content="golang test 使用教程 - garfcat">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-09-27T16:15:18&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-09-27T16:15:18&#43;08:00'>
        
    <meta name="Keywords" content="go,golang,后端">
    <meta name="description" content="golang test 使用教程">
        
    <meta name="author" content="garfcat">
    <meta property="og:url" content="http://www.geekgame.site/post/language/golang/test/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
    
    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://www.geekgame.site">
                        garfcat
                    </a>
                
                <p class="description">make it simple, keep it clean.</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="http://www.geekgame.site">首页</a>
                    
                    <a  href="http://www.geekgame.site/archives/" title="归档">归档</a>
                    
                    <a  href="http://www.geekgame.site/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">golang test 使用教程</h1>
        </header>
        <date class="post-meta meta-date">
            2020年9月27日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>单测是提高代码质量的重要一环,在提交代码尤其是开源社区单测一般是必需要随代码一起提交的,下面我们来看一下Golang中是如何写单元测试的。
Go中提供了专门用来写单元测试的包 testing， 运行时只需要 go test  即可。
单元测试主要分为以下三类：</p>
<ul>
<li>功能测试（Test）</li>
<li>性能测试（Benchmark）</li>
<li>示例测试（Example）</li>
</ul>
<p>测试文件名称一般是源代码文件加上 &ldquo;_test.go&rdquo;, 比如 源代码文件为 add.go ，则测试文件名称为add_test.go。</p>
<p>在展开单元测试之前先讲下,testing包中的输出函数：</p>
<ul>
<li>t.Log() :  正常日志输出;</li>
<li>t.Errorf():  错误日志输出，当前函数继续运行;</li>
<li>t.Fatalf():  错误日志输出，当前函数立刻退出；</li>
</ul>
<h2 id="功能测试">功能测试</h2>
<p>测试函数有两点约定：</p>
<ol>
<li>函数名必需以Test为前缀，如需要测试Add函数则名称应该为
TestAdd;</li>
<li>函数参数必需为 t * testing.T;
完整的功能测试如下所示：</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#998;font-style:italic">// add.go
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">Add</span>(a <span style="color:#458;font-weight:bold">int</span>, b <span style="color:#458;font-weight:bold">int</span>) <span style="color:#458;font-weight:bold">int</span> {
    <span style="color:#000;font-weight:bold">return</span> a <span style="color:#000;font-weight:bold">+</span> b 
}

<span style="color:#998;font-style:italic">// add_tesg.go
</span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestAdd</span>(t <span style="color:#000;font-weight:bold">*</span>testing.T){
    a <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">1</span>
    b <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">2</span> 
    want <span style="color:#000;font-weight:bold">:=</span> a <span style="color:#000;font-weight:bold">+</span> b 
    got <span style="color:#000;font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">Add</span>(a, b)
    <span style="color:#000;font-weight:bold">if</span> want <span style="color:#000;font-weight:bold">!=</span> got {
        t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#d14">&#34;Add(%d, %d) = %d, want %d&#34;</span>, a, b, got, want)
    }
}
</code></pre></td></tr></table>
</div>
</div><p>在运行的时候可以使用 go test 执行该目录下的所有功能测试函数， 也可以通过 go test -run Xxxx 指定特定测试函数运行，-v 可以显示每个测试函数的执行结果， 如下所示：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">➜    go <span style="color:#0086b3">test</span> -v
<span style="color:#000;font-weight:bold">===</span> RUN   TestAdd
--- PASS: TestAdd <span style="color:#000;font-weight:bold">(</span>0.00s<span style="color:#000;font-weight:bold">)</span>
PASS
ok  	learn/golang/test	0.185s
</code></pre></td></tr></table>
</div>
</div><h1 id="性能测试">性能测试</h1>
<p>性能测试函数有两点约定：</p>
<ol>
<li>函数名必需以Benchmark为前缀，如需要测试Add函数则名称应该为
BenchmarkAdd;</li>
<li>函数参数必需为 b * testing.B;
完成测试函数如下所示：</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">BenchmarkRandInt</span>(b <span style="color:#000;font-weight:bold">*</span>testing.B) {
	<span style="color:#000;font-weight:bold">for</span> i <span style="color:#000;font-weight:bold">:=</span> <span style="color:#099">0</span>; i &lt; b.N; i<span style="color:#000;font-weight:bold">++</span> {
		rand.<span style="color:#900;font-weight:bold">Int</span>()
	}
}
</code></pre></td></tr></table>
</div>
</div><p>在运行的时候可以执行如下命令：</p>
<ol>
<li>go test -bench=.  ：执行该目录下的所有测试函数(包含功能测试和性能测试)；</li>
<li>go test -bench=.  -run=^$  ：执行该目录下的性能测试函数；</li>
<li>go test -bench=BenchmarkRandInt -run=^$: 执行性能测试函数BenchmarkRandInt；</li>
</ol>
<p>-bench: 只有有个该标志才会执行性能测试函数；
-run: 这个标志表示要执行哪些功能测试函数，默认是全部，^$ 表示空，即不执行功能测试函数；</p>
<p>执行结果如下：</p>
<pre><code class="language-sbtshell" data-lang="sbtshell">➜    go test -bench=BenchmarkRandInt -run=^$
goos: darwin
goarch: amd64
pkg: learn/golang/test
BenchmarkRandInt-8   	70695550	        16.9 ns/op
PASS
ok  	learn/golang/test	1.956s
</code></pre><p>对于测试结果的输出，重点字段解释如下：
BenchmarkRandInt-8 ： 说明执行的测试函数是BenchmarkRandInt， 8说明使用的最大P是8个；
70695550： 执行的总次数；
16.9 ns/op ： 单次平均耗时；
另外如果执行测试函数前有一些耗时的操作，可以使用b.ResetTimer() 重置以下定时器；</p>
<h2 id="示例测试">示例测试</h2>
<p>示例测试函数提供了运行并验证的功能，既可以当作文档又可以用来测试；
示例测试有如下约定：</p>
<ol>
<li>函数名必需以Example为前缀；</li>
<li>通过注释 Output: 来说明正确的输出结果，，在运行测试时，go 会将示例函数的输出和 &ldquo;Output:&rdquo; 注释中的值做比较；</li>
<li>如果输出的顺序不固定可以使用 &ldquo;Unordered output:&rdquo; 开头的注释；
完整测试如下所示：</li>
</ol>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#000;font-weight:bold">func</span> <span style="color:#900;font-weight:bold">ExamplePerm</span>() {
    <span style="color:#000;font-weight:bold">for</span> _, value <span style="color:#000;font-weight:bold">:=</span> <span style="color:#000;font-weight:bold">range</span> <span style="color:#900;font-weight:bold">Perm</span>(<span style="color:#099">5</span>) {
        fmt.<span style="color:#900;font-weight:bold">Println</span>(value)
    }
    <span style="color:#998;font-style:italic">// Unordered output: 4
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// 2
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// 1
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// 3
</span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// 0
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></td></tr></table>
</div>
</div><h1 id="参考">参考</h1>
<p><a href="https://golang.org/pkg/testing/">golang testing</a></p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="http://www.geekgame.site">garfcat</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="http://www.geekgame.site/post/language/golang/test/">http://www.geekgame.site/post/language/golang/test/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        
<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/protocol/tcp_1/">TCP timewait 过多怎么办</a></li>
        
        <li><a href="/post/language/golang/sched/">协程调度原理</a></li>
        
        <li><a href="/post/language/golang/start/">golang 启动过程</a></li>
        
        <li><a href="/post/language/golang/plan9/">golang 栈结构</a></li>
        
        <li><a href="/post/language/golang/module/">Go module</a></li>
        
    </ul>
</div>

        <div class="post-meta meta-tags">
            
            没有标签
            
        </div>
    </article>
    

<div id="vcomments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>

<script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'pSCor7tBnItnANnzoW1f1YUJ-gzGzoHsz',
        appKey: 'DFEhbtQS9nDVy6c8nSY4qYvz',
        notify: 'false',
        verify: 'false',
        avatar:'e',
        placeholder: '请输入评论',
        visitor: 'true'
    });
</script>
</div>

                    <footer id="footer">
    <div>
        &copy; 2020 <a href="http://www.geekgame.site">garfcat By garfcat</a>
        
    </div>
    <br />
</footer>


    
    <script src="//cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js" crossorigin="anonymous"></script>
        <script>(function () {
            if (!window.Diagram) return;
            const blocks = document.querySelectorAll('pre code.language-sequence');
            for (let i = 0; i < blocks.length; i++) {
                const block = blocks[i];
                
                const rootElement = block.parentNode;
                const container = document.createElement('div');
                const id = `js-sequence-diag-${i}`;
                container.id = id;
                container.className = 'align-center';
                container.setAttribute("style", "overFlow-x:auto");
                rootElement.parentNode.replaceChild(container, rootElement);

                const diagram = Diagram.parse(block.childNodes[0].nodeValue);
                diagram.drawSVG(id, window.sequenceDiagramsOptions
                    ? window.sequenceDiagramsOptions
                    : { theme: 'simple' });
            }
        })();
        </script><script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='http://www.geekgame.site/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://www.geekgame.site">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://www.geekgame.site/post/language/golang/test/" title="golang test 使用教程">golang test 使用教程</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/protocol/tcp_1/" title="TCP timewait 过多怎么办">TCP timewait 过多怎么办</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/language/golang/sched/" title="协程调度原理">协程调度原理</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/language/golang/start/" title="golang 启动过程">golang 启动过程</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/language/golang/plan9/" title="golang 栈结构">golang 栈结构</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/language/golang/module/" title="Go module">Go module</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/shell/effective_shell/" title="高效shell">高效shell</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/protocol/mqtt/" title="MQTT 基本概念">MQTT 基本概念</a>
    </li>
    
    <li>
        <a href="http://www.geekgame.site/post/shell/mac%E4%B8%8B%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8D%E5%AD%97/" title="mac  sed 报错">mac  sed 报错</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">分类</a></h3>
<ul class="widget-list">
    
    <li><a href="http://www.geekgame.site/categories/%E5%8D%8F%E8%AE%AE/">协议 (2)</a></li>
    
    <li><a href="http://www.geekgame.site/categories/%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4/">工具命令 (2)</a></li>
    
    <li><a href="http://www.geekgame.site/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言 (4)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href="/tags">标签</a></h3>
<div class="tagcloud">
    
    <a href="http://www.geekgame.site/tags/effective/">effective</a>
    
    <a href="http://www.geekgame.site/tags/go/">go</a>
    
    <a href="http://www.geekgame.site/tags/mac/">mac</a>
    
    <a href="http://www.geekgame.site/tags/module/">module</a>
    
    <a href="http://www.geekgame.site/tags/mqtt/">mqtt</a>
    
    <a href="http://www.geekgame.site/tags/sched/">sched</a>
    
    <a href="http://www.geekgame.site/tags/sed/">sed</a>
    
    <a href="http://www.geekgame.site/tags/shell/">shell</a>
    
    <a href="http://www.geekgame.site/tags/stack/">stack</a>
    
    <a href="http://www.geekgame.site/tags/start/">start</a>
    
    <a href="http://www.geekgame.site/tags/tcp/">tcp</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="http://www.geekgame.site/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>